# 5장 스토리지 서비스 Amaxon S3
## 5.1 Amazon S3란: 사용하기 쉬우면서 기능이 강력한 스토리지 서비스
객체 스토리지: 데이터를 객체 단위로 관리하는 형식</br>
Amazon S3는 정적 웹 서버 기능과 쿼리 기능을 제공한다.
</br></br>

## 5.2 스토리지 클래스: 다양한 종류의 스토리지
* Standard</br>
  3곳 이상의 AZ(가용 영역)에 데이터가 저장되어 있다.</br>
  데이터를 검색할 때의 요금과 최소 용량(최소량)의 요금이 없고 일할 계산된다.</br>
* Intelligent-Tiering</br>
  빈번한 액세스와 간헐적 액세스에 최적화된 두 가지 계층에 객체(파일)를 모니터링해 자동으로 저장한다.</br>
  최소 저장 기간에 대한 요금이 설정되어 있다.</br>
* Infrequent Access</br>
  Standard 클래스에 비해 저장 요금이 낮은 대신 액세스 요금이 높다.</br>
  Standard-Infrequent Access: 최소 3개 이상의 AZ에 저장된다.</br>
  One Zone-Infrequent Access: 1개의 AZ에 저장된다.</br>
* Reduced Redundancy Storage(RRS)</br>
  Standard에 비해 이중화 수준을 낮춰서 낮은 가격에 제공된다.</br>
  1개의 AZ에 저장된다.</br>
* S3 Glacier/S3 Glacier Deep Archive</br>
  데이터 아카이브와 장기간 백업을 고려하여 만든 스토리지 클래스로 가격이 낮다.</br>
  데이터는 '볼트'라고 하는 컨테이너에 저장되어 저장된 데이터를 읽을 때 다른 S3 버킷으로 옮겨야 하는 작업이 필요하다.</br>
  검색할 경우 Glacier상의 데이터와 검색 대상의 데이터 양쪽에 요금이 부과된다.(S3와 Glacier 둘 다 요금 부과)
</br></br>

## 5.3 S3의 사용 절차: 스토리지 서비스를 사용하기까지
AWS Transfer for SFTP가 제공되어서 SFTP(SSH로 암호화된 파일 전송 프로토콜)로 액세스해 S3에 파일을 업로드 할 수도 있다.</br>

* API: 운영 체제나 프로그래밍 언어가 제공하는 기능을 제어할 수 있도록 만든 인터페이스로, 절차와 데이터 형식 등을 포함하고 있다.</br>
* SDK: 소프트웨어 프레임워크, 하드웨어 플랫폼, 컴퓨터 시스템, 게임기, 운영 체제 등을 위한 소트프웨어를 만들 때 필요한 도구를 모아 놓은 패키지이다.</br>
</br>
<i>S3 서비스와 기능</i></br>

* 객체: S3의 엔티티 단위로 파일을 말한다.
* 버킷: 객체는 저장하는 컨테이너이다.
* 버킷명: AWS 사용자를 포함하여 유일한 이름이어야하며 웹 서버로 사용할 경우 도메인명이 버킷이 된다.
* 객체 키: 버킷, 객체 키, 버전을 조합하여 객체를 고유하게 식별한다.
* 객체 메타데이터: 이름과 값의 세트이다.
* 리전
* Amazon S3의 데이터 일관성 모델: S3는 가용성 유지를 위해 데이터를 자동 복제하여 저장해서 쓰는데 복제가 모두 반영되기까지 다소 시간이 걸릴 수 있다.
* 버전 관리
* 로그: 버킷 단위나 객체 단위의 로그를 기록할 수 있으나 객체 단위는 유료이다.
* 암호화
* 액세스 제어
* 웹 서비스
</br></br>

## 5.4 객체와 버킷: 파일과 파일을 저장하는 장소
버킷 안에 버킷을 만드는 것은 불가하다.</br>
버킷은 AWS 계정 당 100개까지 생성할 수 있으며 별도 신청 시 1,000개까지 생성이 가능하다.</br>
객체는 폴더와 같은 계층 구조가 아닌 병렬로 배치되며 관리 콘솔에서는 편의를 위해 폴더로 표시된다.</br>
<i>버킷명 규칙</i></br>
* 처음과 마지막에 알파벳이나 숫자를 사용해야 한다.
* 대문자 혹은 언더스코어는 버킷명으로 사용할 수 없다.
* DNS 명명 규칙에 따라야 한다.
</br></br>

## 5.5 버킷 정책과 사용자 정책: 액세스 제한 설정
* 버킷 정책: 해당 버킷에 접속할 수 있는 사용자 지정
* 사용자 정책: 접속 가능한 버킷 지정
* ACL(액세스 제어 목록): 자신 외의 다른 AWS 계정의 읽기/쓰기에 대해서 허가/거부를 설정한 목록
</br></br>

## 5.6 웹 사이트 호스팅: 웹 사이트 공개
* Amazon Lightsail</br>
  필요한 기능을 선택하면 웹 사이트에 필요한 서비스 전체를 정해진 가격으로 구출할 수 있는 서비스이다.</br>
  EC2에서 OS, 워드프레스, 고정 IP 주소, DNS를 준비해야하는 것을 Lightsail 하나로 해결할 수 있다.</br>
  CPU나 메모리와 같은 사양, 대수를 변경할 수는 없다.</br>
  변경하고 싶을 떄는 스냅샷을 통해 백업하고 변경하고 싶은 사양의 Lightsail를 새로 만들어서 백업에서 복원하는 작업을 수행해야 한다.</br>
* AWS Amplify</br>
  웹을 개발하기 위한 도구 전체를 제공하는 서비스이다.
</br></br>

## 5.7 파일 업로드와 다운로드: 다양한 파일 업로드 방법
관리 콘솔을 이용해서는 160GB까지의 파일만 업로드 가능하고 이보다 파일이 클 경우 CLI나 SDK를 이용해야 한다.</br>
<i>S3 업로드 방법</i></br>
* API와 SDK</br>
  IAM 사용자에게 액세스 키와 보안 액세스 키를 발행하여 third-party 도구를 사용해 파일을 업로드 할 수 있다.
* 멀티 파트 업로드</br>
  객체를 여러 개로 나누어 세트 하나로 업로드할 수 있는 것으로 업로드가 완료되면 객체 하나가 된다.</br>
  100MB 이상의 파일은 멀티 파트 업로드를 사용할 것을 추천하며 관리 콘솔, CLI는 큰 파일을 업로드할 때 멀티 파트 업로드로 전환된다.
* AWS Transfer for SFTP
* AWS DataSync</br>
  온프레미스 스토리지 시스템과 AWS 스토리지 서비스(EC2, S3) 간에 대용량 데이터 전송을 위한 서비스이다.</br>
  하이브리드 클라우드 스토리지 서비스(AWS Storage Gateway): S3 버킷을 온프레미스의 스토리지처럼 사용할 수 있는 서비스</br>

* 공용 액세스 차단: 버킷 정책이나 사용자 정책이 모든 사용자에 대해서 액세스가 가능하도록 허가되어 있다 하더라도 공용 액세스가 차단한다라고 설정되어 있으면 액세스할 수 없게 된다.
</br></br>

## 5.8 액세스 관리 및 변조 방지: 부정한 액세스 감시
S3는 액세스 로그를 무료로 제공하지만 로그를 기록한 파일은 같은 리전의 버킷에 보관되므로 보관 요금은 발생한다.</br>
-> 요청자 IP, 요청자, 요청 ID, 작업, 키, 요청 URL, 오류 코드, 보낸 바이트, 객체 크디, 총 시간, 반환 시간, Referrer, 사용자 에이전트, 버전 ID, 호스트 헤더</br>
</br>
* 스토리지 클래스 분석</br>
  객체에 액세스 빈도를 분석하는 기능으로 객체를 설정된 날짜별로 그룹화해 각 그룹의 평균 전송 바이트 수를 감시한다.</br>
  대상 객체를 필터링해서 감시하는 것도 가능하며 필터는 버킷당 최대 1,000개까지 설정할 수 있다.</br>
* 객체 잠금</br>
  잠금 기능은 유효 기간이 있는데, 법적으로 보존해야(소송 보존, 소송 등과 관련된 정보를 보호하는 것) 하는 경우에는 유효 기간에 관계없이 보존할 수 있다.</br>
  또한 잠금으로 보호되는 버킷은 Cross-Region Replication(CRR)으로 복사할 수 없다.</br>
  거버넌스 모드: 특정 사용자에게만 객체 변경을 허용하는 모드이다.</br>
  규정 준수 모드: root 사용자를 포함한 모든 사용자가 객체를 변경할 수 없는 모드로 이 모드로 변경하면 모드와 기간을 또 변경할 수 없다.</br>
* S3 인벤토리</br>
  버킷에 들어 있는 객체의 메타데이터의 목록을 매일 혹은 매주 생성하는 기능으로 CSV, ORC 등의 파일로 되어 있다.
</br></br>

## 5.9 버전 관리, 수명 주기, 복제: 저장된 객체 관리
버전 관리란 객체를 여러 버전으로 저장하는 기능으로, 버킷 단위로 설정할 수 있다.</br>
<i>수명 주기 정책을 설정할 수 있는 작업</i></br>
* Transition: 객체를 다른 스토리지 클래스로 이동
* Expiration: 유효 기간이 만료된 객체 삭제
* NoncurrentVersionTransistion: 현재 스토리지 클래스에서 객체의 유지 시간을 지정
* NoncurrentVersionExpiration:과거 버전의 객체를 삭제하기 전에 유지할 시간
* AbortIncompleteMultipartUpload: 멀티 파트 업로드 진행 상태를 유지할 최대 시간을 지정한다.(지정 시간 내에 업로드가 안 되면 중지)
* ExpiredObjectDeleteMarker: 만료된 객체 삭제 표시를 제거한다.</br>
</br>

* 교차 리전 복제(CRR, Cross-Region Replication)</br>
  다른 리전의 버킷에 객체를 비동기적으로 복사하는 것</br>
  복사 대상의 버킷은 원본 버킷과 소유자가 동일하지 않아도 되지만, IAM역할을 부여해야 한다.</br>
  복제에 사용할 두 버킷은 버전 관리가 활성화되어 있어야 하며 같은 리전에 존재하는 버킷은 복제 설정을 할 수 없다.</br>
  해외 리전에 데이터를 복제할 때 국외 반출 불가한 데이터가 있는지 주의해야 한다.
</br></br>

## 5.10 데이터 분석과 연계: 저장된 데이터의 분석
S3 Select, Amazon Athena는 CSV나 JSON을 SQL의 SELECT 문으로 실행하는 기능으로 둘 다 모두 쿼리를 실행하기 위한 서버는 필요하지 않다.</br>
Amazon redshift Spectrum도 비슷하지만 대용량 데이터를 처리하기 때문에 Redshift cluster(데이터 웨어하우스를 제공하는 서비스)가 필요하다.</br>
S3 버킷에 객체를 업로드할 때 트리거로 Lambda 함수를 호출할 수 있다.</br>
</br>
* S3 Select</br>
  S3로 저장된 데이터 파일(CSV, JSON, Apache Parquet) 하나에 SQL 문을 사용하여 집계 및 검색이 가능한 기능</br>
* Amazon Athena와 Amazon Redshift Spectrum</br>
  S3 Select와 다르게 어떤 대상에 대해 어떤 검색을 할지 사전에 구성해야하는 대신 여러 파일을 대상으로 수행할 수 있다.</br>
  Athena는 매번 필요에 따라 분석용 서버를 자동으로 생성해서 실행하기 때문에 실행하는 순간만 비용이 밠생한다.</br>
  Athena는 집계나 검색 방법을 저장할 수 있다.</br>
  Redshift Spectrum은 미리 분석용 서버를 시작하고 이 서버를 사용하여 분석한다.</br>
  대용량의 복잡한 데이터를 빠른 속도로 처리해야 할 경우는 Redshift Spectrum을 사용하는 것이 좋다.
</br></br>

## 5.11 Amazon CloudFront: 콘텐츠 배포 서비스
* Amazon CloudFront</br>
  고속 콘텐츠 전송 네트워크(CDN, Content Delivery Network) 서비스이다.</br>
  엣지 서버를 사용하여 웹 서버의 부담을 줄이고 사용자도 쉽게 접속할 수 있게 한다.</br>
  TLS/SSL에 의한 암호화 통신을 지원한다.</br>
  AWS Certificate Manager 서버를 사용해 무료로 서버 인증서를 생성할 수 있다.
</br></br></br></br>
