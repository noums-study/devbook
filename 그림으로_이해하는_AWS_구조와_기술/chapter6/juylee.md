# 6장 가상 네트워크 서비스 Amazon VPC
## 6.1 Amazon VPC란: AWS에 생성하는 가상 네트워크
Amazon VPC(Virtual Private Cloud)는 AWS 계정 전용 가상 네트워크 서비스로 AWS에서 제공하는 리소스만 설치할 수 있다.</br>
<i>VPC 주요 기능</i></br>
* CIDR 블록</br>
  VPC를 생성할 때 네트워크 범위를 CIDR로 정하고 이를 더 작은 서브넷으로 나누어 사용한다.
* 서브넷 마스크</br>
  CIDR는 서브넷 마스크의 표기법 중 하나이다.
* 가용 영역</br>
  서브넷이 구축된 물리적 장소
* 인터넷 게이트웨이</br>
  VPC를 인터넷에 연결하지 않을 경우에는 불필요 하다.
* 라우팅</br>
  AWS에서는 소프트웨어가 이 기능을 담당한다.</br>
  인터넷 게이트웨이와 라우팅으로 데이터 송수신을 설정하지 않으면 VPC가 인터넷과 접속되지 않는다.
* 라우팅 테이블</br>
  라우팅 테이블 하나에 서브넷 여러 개를 설정할 수 있다.</br>
  클라우드는 물리적인 서버가 LAN 케이블과 와이파이로 라우터와 연결하던 것과 달리 라우팅 테이블로 연결한다.</br>
* 보안 그룹</br>
  인스턴스 단위로 설정하며 유입되는 데이터는 '거부'가 기본 설정이다.
* 네트워크 ACL</br>
  AWS가 제공하는 가상 방화벽으로 서브넷 단위로 설정된다.</br>
</br>
VPC는 라우터 없이 직접 통신할 수 있으며 VPC 하나에 인터넷 게이트웨이 한 개만 설정할 수 있다.</br>
라우터와 인터넷 게이트웨이는 명시적인 IP 주소가 부여되지 않는다.
</br></br>

## 6.2 VPC의 사용 절차: 가상 네트워크를 사용하자
인터넷 게이트웨이, 오토 스케일링, IP, 포트 설정 등을 고려해야 한다.
</br></br>

## 6.3 기본 VPC: AWS가 제공하는 기본 VPC
기본 VPC는 서브넷과 인턴세 게이트웨이가 기본적으로 구성되어 있다.</br>
네트워크 범위는 사설 IP 주소 172.31.0.0/16이 부여된다.</br>
기본 VPC는 기본 서브넷이라는 서브넷이 가용 영역별로 한 개씩 생성되어 있으며 서울 리전의 경우 총 4개의 서브넷이 있다.(주소범위는 /20)
</br></br>

## 6.4 서브넷과 DHCP: 사용할 범위 선택
서브넷은 네트워크를 분할해 직접 통신할 수 있는 범위를 좁히고, 방화벽을 설정해 보안을 강화하는 것을 목적으로 한다.</br>
일반적인 네트워크의 경우 서브넷끼리 통신하려면 라우팅이 필요하지만, VPC의 경우에는 라우팅 없이도 통신할 수 있다.</br>

* CIDR(Classless Inter-Domain Routing)</br>
  프리픽스 표기라고도 하는 표기법으로, /24, /20처럼 네트워크 길이를 숫자로 적어서 표기한다.</br>
  2의 '32-네트워크 길이' 제곱</br>
</br>

<i>네트워크 클래스<i></br>
* A클래스</br>
  /8 ~ /15</br>
  범위가 넓은 네트워크</br>
* B클래스</br>
  /16 ~ /23</br>
  중간 규모</br>
* C클래스</br>
  /24 ~ /32</br>
  소규모 범위</br>
AWS는 서브넷으로 사용할 수 있는 범위가 최대 /16이므로 A클래스를 서브넷으로 설정할 수 없다.</br>

* DHCP(Dynamic Host Configuration Protocol)</br>
</br>

  사용할 수 있는 IP 주소 풀을 보유하고 있어, 클라이언트에게 자동으로 IP를 할당하는 서버이다.</br>
서브 넷의 첫 번째부터 네 번째까지의 IP 주소 4개와 마지막 IP 주소는 AWS에 예약된 IP 주소이기 때문에 사용할 수 없다. 따라서 사용할 수 있는 IP 주소 개수는 5를 뺀 나머지이다.
</br></br>

## 6.5 라우팅과 NAT: 공인 IP 주소와 사설 IP 주소 변환
라우터는 네트워크의 고나문에 위치해 있기 때문에 관문이라는 의미로 게이트웨이라고도 한다.</br>
게이트웨이 중에 '자신 이외의 접속되어 있는 모든 것(대부분의 경우 인터넷과의 연결점)'을 기본 게이트웨이라고 한다.</br>
* IP 마스커레이드(masquerade)(NAPT(Network Address Port Translation)</br>
  내부에서 외부로 나갈 때 포트를 포함한 사설 IP 주소를 공인 IP 주소로 변환하는 것을 담당한다.</br>
* NAT(Network Address Translation, 네트워크 주소 변환)</br>
  IP 마스커레이드는 일대다, NAT은 다대다이다.</br>
  NAT은 포트를 변환할 수 없다.
</br></br>

## 6.6 인터넷 게이트웨이와 NAT 게이트웨이: VPC에서 인터넷으로 접속
EC2 인스턴스는 사설 IP 주소 박에 설정할 수 없기 때문에 인터넷 게이트웨이가 공인 IP 주소(목적지)를 사설 IP 주소로 변환하여 해당 EC2 인스턴스에 요청을 보낸다.</br>
* NAT 게이트 웨이</br>
  서브넷에서 인터넷으로 접속할 수 있지만, 인터넷에서 서브넷으로 접속하지 못하게 한다.
</br></br>

## 6.7 보안 그룹과 네트워크 ACL: 보안 설정
<table>
  <tr>
    <th></th>
   	<th>보안그룹</th>
    <th>네트워크 ACL</th>
  </tr>
  <tr>
   <td>설정범위</td>
   <td>인스턴스에 대해 설정하한다. (보안 그룹을 최대 5개까지 할당할 수 있다.)</td>
   <td>서브넷에 설정한다.</td>
  </tr>
  <tr>
   <td>규칙</td>
   <td>규칙 허용만 가능하다.</td>
   <td>규칙 허용과 거부가 가능하다.</td>
  </tr>
  <tr>
   <td>설정</td>
    <td>스테이트풀(stateful)</br>
        규칙과 상관 없이 반환된 트래픽을 자동으로 허용한다.</td>
   <td>스테이트리스(stateless)</br>
        반환된 트래픽을 규칙에 따라 명시적으로 허용한다.</td>
  </tr>
  <tr>
   <td>규칙의 적용 순서</td>
   <td>모든 규칙을 확인하여 트래픽의 허가 여부를 정한다.</td>
   <td>순서대로 규칙을 처리하면서 트래픽의 허가 여부를 정한다.</td>
  </tr>
</table>
</br>
서브넷 하나에 네트워크 ACL을 여러 개 설정할 수 없다.</br>
보안 그룹은 인바운드를 허가하지 않으며 아웃바운드를 허가하는 것이 기본이고, 네트워크 ACL은 양쪽 모두를 허가하는 것이 기본 설정이다.</br>
</br>
* 데몬(서비스)</br>
  PC 전원이 켜져 있는 동안 계속해서 동작하고 있는 소프트웨어를 말한다.
</br></br>

## 6.8 VPC 엔드포인트: 다른 AWS 서비스 및 엔드포인트 서비스와 연결
* VPC 엔드포인트</br>
  인터넷 게이트웨이를 통하지 않고 VPC와 VPC 외부 서비스를 직접 연결해주는 서비스
* 인터페이스 엔드포인트</br>
  네트워크 인터페이스(ENI, Elastic Network Interface)로 구축하는 유형</br>
  사설 IP를 가진 ENI가 존재하며 각 서비스와 연결하는 출입구 역할을 한다.</br>
  AWS PrivateLink 방식을 사용하므로 AWS 외에 타사 서비스가 AWS PrivateLink를 지원한다면 사용할 수 있다.</br>
* 게이트웨이 인터페이스</br>
  라우팅 테이블에 설정된 내용을 라우팅하는 유형</br>
  서비스 리전 단위로 라우팅 테이블을 설정하는 방식</br>
  S3와 DynamoDB가 이런 형식
</br></br>

## 6.9 VPC 연결: VPC와 VPC의 연결과 VPC와 VPN의 연결
* VPC 피어링</br>
  VPC끼리 연결하는 기능
* AWS Direct Connect</br>
  전용선:비싸지만 안전하고 신뢰성이 높다.</br>
  전용선으로 접속하기 때문에 회선 공사가 필요하며 AWS에 해당 접속을 처리할 라우터를 설치해야 하므로 도입 규모가 크며 월 비용도 많이 발생한다.</br>
  * 프라이빗 연결: VPC에 사설 게이트웨이를 구축하고 이를 경유하여 통신하는 방법으로 퍼블릿 연결과 다르게 VPC를 지원하지 않는 서비스(S3, DynamoDB)를 사용할 수 없다.</br>
  * 퍼블릭 연결: 각 서비스와 직접 연결</br>
* AWS VPN</br>
  가상 사설망: 보유하고 있는 회선뿐만 아니라 공용 회선을 사용하여 거점끼리 통신을 암화화하여 연결한다.</br>
  인터넷 VPN: 인터넷 회선만 사용므로 회선 공사 없이 VPN을 지원하는 라우터만 설치하면 된다.</br>
  VPC에 VPG(Virtual Private Gateway)를 구축해 VPG로 주요 라우터 기종의 설정 파일을 내려 받아 수정해 사용한다.</br>
* 전송 게이트웨이</br>
  VPC나 온프레미스 네트워크(AWS Direct Connect 게이트웨이, VPC 연결)를 하나로 묶어 서로 연결하는 '접속점'을 제공하는 서비스이다.
</br></br></br></br>
