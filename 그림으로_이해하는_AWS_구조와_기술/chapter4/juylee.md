# 4장 서버 서비스 Amazon EC2
# Amazon EC2란: 짧은 시간에 실행 환경을 구축할 수 있는 가상 서버
### Amazon EC2란
* Amazon Elastic Compute Cloud
* 컴퓨팅 용량을 제공하는 서비스로 서버에 필요한 세트를 클라우드에서 빌릴 수 있다.
<i>스케일 아웃: 동일 서버를 여러 개 늘려서 수평으로 확장하는 것</i>
</br></br>

## 4.2 EC2의 사용 절차: 가상 서버를 사용하기까지
* 인스턴스</br>
  AWS 클라우드에 생성한 가상 서버를 의미한다.
* AMI</br>
  가상 이미지를 말하는 것으로 OS만 설치된 간단한 유형부터 소프트웨어도 설정된 유형까지 다양하다.
* 키 페어</br>
  인스턴스에 접속할 때 인증을 위해 사용하는 키이다.
* EBS</br>
  AWS 클라우드에서 사용할 수 있는 스토리지로 인스턴스 스토리지로 사용한다.
* 보안 그룹</br>
  가상 방화벽으로 1개 이상의 인스턴스 트래픽을 제한한다.
* Elastic IP</br>
  고정 IPV4 주소이다.
</br>

<i> 인스턴스 설정 항목</i></br>

* 네트워크</br>
  EC2 인스턴스를 배치할 네트워크로 AWS의 VPC를 선택한다.</br>
* 서브넷</br>
  설치할 네트워크의 범위로 VPC 내에 어떤 서브넷을 설치할지 선택한다.</br>
  서브넷을 선택하면 가용 영역이라고 하는 설치 장소와 어떤 범위에 사설 IP가 부여될지 결정된다.</br>
* 스토리지의 용량과 종류</br>
 서버 장비의 스토리지로 OS가 설치된 장소에 있다.</br>
 기본적으로 EBS를 선택하고 사용할 디스크 용량과 스토리지의 종류를 선택한다.</br>
 인스토어 스토어: 전원이 끊기면 데이터가 사라지지만 읽기 성능이 빨라진다. 일부 인스턴스 유형에 대응된다.</br>
 S3와 같은 외부 스토리지는 선택할 수 없다.</br>
* 태그(EC2 인스턴스의 레이블)</br>
  인스턴스에 임의의 태그를 부여할 수 있다.
</br>

* EC2 인스턴스에는 사설 IP 주소를 부여하고 NAT에 의해 공인 IP 주소로 변환된다.
  기전별로 하나 씩 존재하는 기본 VPC에는 이미 NAT가 설정되어 있고, 공인 IP 주소도 할당할 수 있다.
</br></br>

## 4.3 인스턴스 생성과 요금: 가상 서버 생성 예시
* T2/T3 무제한</br>
  인스턴스 유형이 T2 또는 T3일 때만 선택할 수 있는 옵션으로 부하가 높아졌을 때 버스트(일시적으로 고성능을 낼 수 있는 기능)을 무제한으로 쓰는게 가능하다.</br>
  단, 일반적인 버스트를 초과하여 사용할 경우 별도로 요금이 부과된다.
</br></br>

## 4.4 AMI: OS 및 소프트웨어가 설치된 디스크 이미지
* AMI(Amazon Machine Image)</br>
  서버 디스크에 설치된 내용이 통째로 들어 있다.</br>
  AMI에서 인스턴스를 생성하면 전부 복사되고 어떤 AMI라도 반드시 OS가 설치되어 있다.</br>
  AMI는 AWS 공식 AMI 뿐만 아니라 커뮤니티, 기업이 생성한 AMI도 제송한다.</br>
  AMI를 올릴 수 있는 마켓플레이스도 있다.
</br></br>

## 4.5 인스턴스 유형: 용도에 맞게 머신을 선택하자
<i>인스턴스 유형 = 머신의 용도</i></br>
<i>인스턴스 유형 + 인스턴스 크기 = 인스턴스 성능</i></br>
* 범용</br>
  T2, T3, M5, M4</br>
  일정한 서버에 경우 사용 - 컴퓨팅 최적화</br>
  C5, C4- 연산 능력이 높은 서버</br>
* 메모리 최적화</br>
  X1e, X1 - 메모리 액세스 속도가 높다</br>
  R4 - 대용량 메모리</br>
* 가속화된 컴퓨팅 최적화</br>
  P3, P2, G3, F1 - GPU 탑재 및 그래픽 기능이 높은 서버</br>
* 스토리지 최적화</br>
  H1, I3, D2 - 스토리지 최적화, I3는 SSD
</br></br>

## 4.6 Amazon EBS: Amazon EC2의 스토리지 볼륨
* Amazon EBS(Elastic Block Store)</br>
  영구적인 블록 스토리지 볼륨</br>
  블록 스토리지 볼륨은 데이터를 바이트 블록 단위로 디스크에 저장하는 일반적인 방식이다.</br>
  
<i>EBS 기능</i>
* 탄력적 볼륨
* 스냅샷
* 데이터 라이프 사이클 매니저: 일정에 따라 스냅샷을 생성, 삭제하는 기능
* 최적화 인스턴스: 특정 인스턴스 유형을 최적화 인스턴스로써 읽기 쓰기를 고ㅗㄱ화하는 기능
* 암호화
</br><</br>

## 4.7 SSH를 사용한 접속과 키 페어: 공개키 암호 방식을 이용한 접근 관리
EC2는 서버에 설치한 소프트웨어의 SSH로 키 페어라는 방식을 사용해 관리하는데 키 페어 파일을 분실하면 서버 자체를 다시 만들어야 한다.</br>
* 키 페어</br>
  공개키 방식(비대칭키 방식)</br>
  인스턴스 쪽에서 키 페어에 포함되어 있는 공개키를 지정하고, 클라이언트쪽 소프트웨어(putty 등)에서 내려받은 키 페어 파일을 비밀키로 설정해서 사용한다.</br>
  같은 리전의 서비스라면 공통의 키 페어를 사용할 수 있으며 추가 비용이 들지 않는다.
</br></br>

## 4.8 Elastic IP 주소: 고정 공인 IP 주소를 부여
이미 공인 IP가 할당되어 있는 인스턴스에 Elastic IP를 할당하면 할당되어 있던 IP는 AWS 공인 IPv4 풀(인스턴스에 할당하기 위해 확보한 IP 주소)로 되돌아간다.</br>
다른 리전이 보유하고 있는 Elastic IP 주소는 사용할 수 없다.
</br></br>

## 4.9 Elastic Load Balancing: 트래픽을 분배하는 분산 장치
<i> ELB = 부하 분산 장치</i></br>
* ALB(Application Load Balancer)</br>
  HTTP, HTTPS</br>
  OSI 애플리케이션 계층</br>
  요청되는 명령어의 내용을 보고 판단하기 떄문에 대상의 URL 디렉터리 단위로 분배하는 것이 가능하다.</br>
  인스턴스와 로드 밸런서 사이의 통신은 암호화가 가능하지만 분배 대상을 정적 IP 주소로 설정하는 것은 불가능하다.
* NLB(Network Load Balancer)</br>
  TCP, TLS</br>
  OSI 전송 계층</br>
  패킷이라는 단편 데이터를 보고 분배할 수 있다.</br>
  분배 대상 정적 IP 주소를 설정할 수 있고 서버에 접속한 클라이언트의 IP 주소를 그대로 서버에 전송하도록 설정할 수 있다.</br>
* CLB(CLassic Load Balancer)</br>
  TCP, SSL/TLS, HTTP, HTTPS</br>
  오래된 유형의 로드 밸런서로 지원하는 프로토콜이 많지만 앞으로 구축할 시스템에는 되도록 사용하지 않는게 좋다.
</br></br>

## 4.10 스탭샷: 서버 데이터 백업
AWS는 Amazon EBS 볼륨의 데이터를 스냅샷으로 보존할 수 있으며 Amazon EBS 볼륨의 데이터를 Amazon S3에 백업할 수 있다.</br>
최초에는 통째로 보존하지만 두 번째 이후에는 비용 절감을 위해 차분(증분)만 보존한다.</br>
데이터 수명주기 관리자(Amazon DLM)을 사용하면 스냅샷의 생성, 삭제를 자동화할 수 있다.</br>
스냅샷 데이터 보존 장소는 Amazon S3이지만 스냅샷 파일은 사용자가 S3를 사용할 때의 영역과는 다른 영역으로 사용자가 자유롭게 다운로드 할 수 없다. 대신 S3 요금은 발생하지 않는다
</br></br>

## 4.11 오토 스케일링: 수요에 맞춰 EC2 대수를 증감
Auto Scaling 그룹은 서버 시작에 필요한 AMI, 키 페어, 보안 그룹 등을 설정해야 한다.</br>
<i>인스턴스 증감 방법</i>
* EC2 인스턴스가 정지한 경우에 분리하고 새로운 EC2 인스턴스를 생성하는 방법
* 일정에 맞춰 스케일링하는 방법
* CPU와 네트워크의 부하를 참고하여 특정 임계 값을 넘을 때 인스턴스 수를 자동적으로 증감하는 방법
</br></br></br></br>
